<div class="license-plate-list">
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Loading license plate data...</p>
  </div>

  <div
    *ngIf="!isLoading && (groupedLicensePlates$ | async) as groupedList"
    class="list-container"
  >
    <div
      *ngIf="getTotalCount(groupedList) === 0"
      class="empty"
    >
      <p class="empty-text">
        {{ searchTerm ? 'No license plates found for "' + searchTerm + '"' : 'No license plates available' }}
      </p>
      <p class="empty-hint" *ngIf="searchTerm">
        Try entering fewer letters or check your spelling.
      </p>
    </div>

    <div
      *ngIf="getTotalCount(groupedList) > 0"
      class="results"
    >
      <div class="groups">
        <div
          *ngFor="let group of groupedList; let i = index; trackBy: trackByState"
          class="group"
        >
          <h3 class="group-heading">
            {{ group.state }} ({{ group.licensePlates.length }})
            <app-view-toggle
              [currentView]="(viewMode$ | async) || 'alphabetical'"
              (viewChange)="onViewChange($event)"
              class="view-toggle"
            ></app-view-toggle>
          </h3>
          <div class="group-items">
            <app-license-plate-item
              *ngFor="let licensePlate of group.licensePlates; trackBy: trackByCode"
              [licensePlate]="licensePlate"
              [isSeen]="(seenCodes$ | async)?.has(licensePlate.code) || false"
              [isSelected]="licensePlate.code === selectedCode"
              [searchTerm]="searchTerm"
              [seenDate]="getSeenDate(licensePlate.code)"
              (itemClicked)="onItemClicked($event)"
            ></app-license-plate-item>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
