<div class="settings">
  <button
    class="settings-button"
    (click)="toggleMenu()"
    [attr.aria-label]="(translations$ | async)?.language || 'Settings'"
  >
    <span class="material-icons">settings</span>
  </button>

  @if (isMenuOpen) {
  <div class="settings-menu" (click)="$event.stopPropagation()">
    <div class="menu-header">
      <h3>{{ (translations$ | async)?.settings }}</h3>
      <button class="close-button" (click)="closeMenu()">
        <span class="material-icons">close</span>
      </button>
    </div>

    <div class="menu-content">
      <button class="menu-item" (click)="toggleLanguage()">
        <span class="material-icons">translate</span>
        <div class="item-content">
          <span class="item-label">{{ (translations$ | async)?.language }}</span>
          <span class="item-value">{{ getCurrentLanguageLabel() }}</span>
        </div>
      </button>

      <button class="menu-item" (click)="cycleTheme()">
        <span class="material-icons">palette</span>
        <div class="item-content">
          <span class="item-label">{{ (translations$ | async)?.theme }}</span>
          <span class="item-value">{{ getCurrentThemeLabel() }}</span>
        </div>
      </button>

      <button class="menu-item" (click)="showSyncModalAction()">
        <span class="material-icons">cloud</span>
        <span class="item-text">Enable Sync</span>
      </button>
    </div>
  </div>
  }
</div>

@if (isMenuOpen) {
<div class="settings-overlay" (click)="closeMenu()"></div>
} @if (showSyncModal) {
<div class="sync-modal-overlay" (click)="showSyncModal = false">
  <div class="sync-modal" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <h3>Cloud Sync</h3>
      <p>Share your sync code to sync data across devices</p>

      @if (shortCode$ | async; as shortCode) {
      <div class="license-plate-section">
        <app-sync-license-plate [shortCode]="shortCode"></app-sync-license-plate>
        <app-button variant="square" (clicked)="copyUserId()" [ariaLabel]="'Copy your sync code'">
          <span class="material-icons">content_copy</span>
        </app-button>
      </div>
      }

      <div class="input-section">
        <p class="input-label">Have a code?</p>
        <div class="user-id-input-group">
          <input
            type="text"
            [(ngModel)]="userIdInput"
            placeholder="Enter sync code..."
            class="user-id-input"
            #userIdField
          />
        </div>
      </div>

      <div class="modal-buttons">
        <app-button variant="transparent" (clicked)="showSyncModal = false">Cancel</app-button>
        <app-button variant="primary" (clicked)="onSubmitUserId()">Submit</app-button>
      </div>
    </div>
  </div>
</div>
}
