<div class="app">
  <div class="sticky-header">
    <div class="container">
      <app-license-plate-display
        [enteredText]="currentSearchTerm"
        class="plate-display"
      ></app-license-plate-display>

      <div class="controls">
        <app-search-input
          [externalValue]="currentSearchTerm"
          [seenCodes$]="seenCodes$"
          (searchChange)="onSearchChange($event)"
          (seenClick)="onSeenClick($event)"
          class="search"
        ></app-search-input>
        <app-settings class="settings"></app-settings>
      </div>
    </div>
  </div>

  <main class="main">
    <div class="content-wrapper">
      <app-map
        [licensePlates]="(filteredLicensePlates$ | async) || []"
        [selectedCode]="selectedCode"
        [stateFilter]="licensePlateService.getCurrentStateFilter()"
        [seenFilterActive]="isSeenFilterActive"
        [seenCount]="getSeenCount()"
        [availableStates]="availableStates"
        (codeSelected)="onLicensePlateClicked($event)"
        (stateFilterChange)="onStateChange($event)"
        (seenFilterToggle)="onSeenFilterToggle()"
        (clearAllFilters)="onClearAllFilters()"
        class="map-section"
      ></app-map>

      <app-license-plate-list
        [groupedLicensePlates$]="groupedLicensePlates$"
        [seenCodes$]="seenCodes$"
        [searchTerm]="currentSearchTerm"
        [selectedCode]="selectedCode"
        [isLoading]="isLoading"
        [isMapButtonVisible]="isMapButtonVisible"
        [targetScrollPosition]="targetScrollPosition"
        [focusedGroup]="focusedGroup"
        [isLicensePlateSelected]="isLicensePlateSelected"
        (itemClicked)="onLicensePlateClicked($event)"
        (viewChange)="onViewChange($event)"
        (groupHeadingClicked)="onGroupHeadingClicked($event)"
        (backClicked)="onBackClick()"
        (clearFiltersClicked)="onClearAllFilters()"
        class="list"
      ></app-license-plate-list>

      <app-table-of-contents
        [groups]="(groupedLicensePlates$ | async) || []"
        [activeSection]="activeSection"
        (sectionClicked)="onTocSectionClick($event)"
      ></app-table-of-contents>
    </div>
  </main>
</div>
